# 記憶階層
 1. レジスタ
 1. キャッシュメモリ
 1. メモリ
 1. ストレージデバイス

コンピュータには様々な記憶装置があり、番号が小さいほど、サイズは小さく、単位バイトあたりの価格が高価な反面、アクセス速度が高速であることを示す。

 - 具体的にどれだけサイズや性能に差があるのか
 - これらの差を考慮した上で、ハードウェアやLinuxはどのような仕組みになっているのか

## キャッシュメモリ
コンピュータの動作の流れは以下のよう。
 1. 命令をもとに、メモリからレジスタにデータを読み出す
 1. レジスタ上のデータをもとに計算する
 1. 計算結果をメモリに書き出す

レジスタ上の計算とメモリアクセス、両者の所要時間の差を埋めるために存在しているのが、キャッシュメモリである。キャッシュメモリからレジスタにアクセスする際のレイテンシは、メモリからそれに比べて数倍ないし数十倍高速なことを利用して、1,3の部分を高速化する。<br>
キャッシュメモリの処理はカーネルは関与せず、ハードウェア内で完結している。メモリからレジステにデータを読み出す際は、まずキャッシュメモリにデータを読み出した上で、同じデータをレジスタに読み出します。読み出しのサイズはCPUごとに定められている「キャッシュラインサイズ」という値である。<br>

プロセスが実行されてからしばらく経つと、キャッシュメモリの中には、さまざまデータが存在するようになる。ここで、CPUがキャッシュメモリ上に存在するデータだけにアクセスしているうちは、すべてのデータアクセスがキャッシュメモリに対する読み書き速度で実施できるため、キャッシュメモリが存在しない場合より、はるかい高速になる

#### キャッシュメモリがいっぱいになったら
キャッシュ内に存在しないデータを読み書きすると、既存のキャッシュラインのうちの1つを破棄する、破棄するキャッシュがダーティな場合は、同期的に対応するメモリに書き込みした上で捨てる。キャッシュメモリがいっぱいになっているときに、すべてのキャッシュラインがダーティな場合、メモリアクセスのたびにキャッシュライン内のデータが激しく入れ替わるためスラッシングが発生し、大きく性能が劣化する。

## 階層型キャッシュメモリ
x86_64アーキテクチャのCPUは、キャッシュメモリは階層型構造をとっている。それぞれ、サイズ、レイテンシ、どの論理CPUの間で共有するか、などが異なる。<br>
階層型構造を構成する各キャッシュメモリは「L1」「L2」「L3」などという名前がついている。どのレベルのキャッシュが存在するかは、CPUに依存する。最もレジスタに近く、容量が少なく、かつ高速なのがL1キャッシュである。番号が増えるにつれてレジスタからは遠くなり、容量が多く低速になる。

### 